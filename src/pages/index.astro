---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Card from "@/components/Card.astro";
import { getCollection } from "astro:content";

// Hero ä»£ç ç‰‡æ®µ (é¿å… JSX èŠ±æ‹¬å·å†²çª)
const heroCode = `<span class="text-brand-400">import</span> { æ¸—é€å‹, ç¾æ‹‰å¾·ååº” } <span class="text-brand-400">from</span> <span class="text-amber-400">"ç‰©ç†åŒ–å­¦"</span>;

<span class="text-brand-400">function</span> <span class="text-blue-400">ç‚’èŠ¹èœ</span>(èŠ¹èœ: <span class="text-amber-400">300g</span>) {
  <span class="text-gray-600">// step 1: åˆ©ç”¨æ¸—é€å‹é¢„å¤„ç†</span>
  <span class="text-brand-400">const</span> é¢„å¤„ç† = æ¸—é€å‹.è…Œåˆ¶(èŠ¹èœ, {
    ç›: èŠ¹èœ.é‡é‡ * <span class="text-amber-400">0.01</span>,  <span class="text-gray-600">// 1%ç›æµ“åº¦</span>
    æ²¹: <span class="text-amber-400">5</span>ml,                <span class="text-gray-600">// ç–æ°´ä¿æŠ¤å±‚</span>
    æ—¶é—´: <span class="text-amber-400">600</span>s              <span class="text-gray-600">// 10åˆ†é’Ÿ</span>
  });
  <span class="text-brand-400">return</span> çŒ›ç«å¿«ç‚’(é¢„å¤„ç†, { æ¸©åº¦: <span class="text-amber-400">220</span>Â°C });
}`;

// MVP åŸç†æ–‡ç« 
const principles = [
  {
    title: "è„†å«©èŠ¹èœçš„ç§˜å¯†",
    description: "ç”¨æ¸—é€å‹å’Œæ²¹è†œä¿æŠ¤ï¼Œè®©æ¯ä¸€æ ¹çº¤ç»´éƒ½ä¿æŒå®Œç¾è„†åº¦ã€‚",
    href: "/kernel/osmotic-pressure-celery",
    field: "physics" as const,
    tag: "æ¸—é€å‹",
  },
  {
    title: 'è‚‰ç±»"ä¸Šæµ†"çš„åº•å±‚é€»è¾‘',
    description: "æ·€ç²‰ç³ŠåŒ– + è›‹ç™½è´¨å±éšœï¼Œæ„å»ºåŒé‡çƒ­åŠ›é˜²çº¿ã€‚",
    href: "/kernel/meat-velveting",
    field: "chemistry" as const,
    tag: "æ°´åˆååº”",
  },
  {
    title: "çƒ­é”…å¿«ç‚’çš„å¶ç»¿ç´ ä¿å«æˆ˜",
    description: "ä¸ºä»€ä¹ˆçŒ›ç«å¿«ç‚’èƒ½è®©é’èœä¿æŒç¿ ç»¿ï¼Ÿç­”æ¡ˆåœ¨è„±é•ååº”ã€‚",
    href: "/kernel/chlorophyll-protection",
    field: "biology" as const,
    tag: "å¶ç»¿ç´ ",
  },
  {
    title: "å¥¶ç™½é±¼æ±¤çš„èƒ¶ä½“ç§‘å­¦",
    description: "å¤§ç«å‡ºç™½æ±¤ï¼Œå°ç«å‡ºæ¸…æ±¤ã€‚è¿™æ˜¯ä¸€é“ç»å…¸çš„ä¹³åŒ–å®éªŒã€‚",
    href: "/kernel/fish-soup-emulsion",
    field: "chemistry" as const,
    tag: "ä¹³åŒ–ååº”",
  },
];

const modules = [
  {
    id: "MOD_01",
    name: "åŸç†å±‚",
    eng: "Kernel",
    desc: "ç¾æ‹‰å¾·ååº”ã€ç„¦ç³–åŒ–ã€ä¹³åŒ–ã€å˜æ€§â€¦â€¦æ ¸å¿ƒç§‘å­¦æ¦‚å¿µè§£æã€‚",
    href: "/kernel/",
  },
  {
    id: "MOD_02",
    name: "é£Ÿæç­›é€‰",
    eng: "Variables",
    desc: "æŒ‰é£Ÿææ ‡ç­¾æµè§ˆæ‰€æœ‰ç›¸å…³åŸç†ã€èœè°±å’Œè°ƒè¯•æŒ‡å—ã€‚",
    href: "/tags/",
  },
  {
    id: "MOD_03",
    name: "èœè°±åº“",
    eng: "Algorithms",
    desc: "ç²¾ç¡®åˆ°å…‹ã€ç§’ã€Â°C çš„æ ‡å‡†ä½œä¸šç¨‹åº (SOP)ã€‚",
    href: "/recipes/",
  },
  {
    id: "MOD_04",
    name: "è°ƒè¯•åŒº",
    eng: "Debugging",
    desc: "çƒ¹é¥ªå¤±è´¥ï¼Ÿè¿™é‡Œæœ‰ Root Cause Analysisã€‚",
    href: "/debug/",
  },
  {
    id: "MOD_05",
    name: "çƒ¹é¥ªæ–¹æ³•",
    eng: "Methods",
    desc: "å¿«ç‚’ã€ç‚–ç…®ã€è’¸åˆ¶ã€ç…ç‚¸ç­‰ 8 å¤§ç±»æ–¹æ³•åŠèƒŒåçš„ç§‘å­¦ã€‚",
    href: "/methods/",
  },
  {
    id: "MOD_06",
    name: "å·¥å…·ç®±",
    eng: "Tools",
    desc: "å•ä½æ¢ç®—å™¨ã€çƒ­åŠ›å›¾è°±ã€é£Ÿææ•°æ®åº“â€”â€”é‡åŒ–çƒ¹é¥ªçš„è¾…åŠ©å·¥å…·ã€‚",
    href: "/tools/",
  },
];

// â”€â”€ æœ€è¿‘æ›´æ–° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const [allPrinciples, allRecipes, allDebugging] = await Promise.all([
  getCollection("principles"),
  getCollection("recipes"),
  getCollection("debugging"),
]);

type ContentType = "åŸç†" | "èœè°±" | "è°ƒè¯•";
const typeStyle: Record<ContentType, string> = {
  åŸç†: "text-brand-400 bg-brand-500/10 border-brand-500/20",
  èœè°±: "text-amber-400 bg-amber-500/10 border-amber-500/20",
  è°ƒè¯•: "text-red-400 bg-red-500/10 border-red-500/20",
};

const recentItems = [
  ...allPrinciples.map((e) => ({
    type: "åŸç†" as ContentType,
    href: `/kernel/${e.slug}`,
    title: e.data.title,
    description: e.data.description,
    date: e.data.date,
  })),
  ...allRecipes.map((e) => ({
    type: "èœè°±" as ContentType,
    href: `/recipes/${e.slug}`,
    title: e.data.title,
    description: e.data.description,
    date: e.data.date,
  })),
  ...allDebugging.map((e) => ({
    type: "è°ƒè¯•" as ContentType,
    href: `/debug/${e.slug}`,
    title: e.data.title,
    description: e.data.description,
    date: e.data.date,
  })),
]
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);

const fmtDate = (d: string) => {
  const [, m, day] = d.split("-");
  return `${parseInt(m)}æœˆ${parseInt(day)}æ—¥`;
};

// â”€â”€ ç²¾é€‰ä¸»é¢˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const featuredTopics = [
  {
    name: "æ°´é¥ºä¸“é¢˜",
    emoji: "ğŸ¥Ÿ",
    description: "ä»æ‹Œé¦…åˆ°ç…®æ³•ï¼Œæ‹†è§£é¥ºå­çš„å…¨å¥—ç§‘å­¦â€”â€”é¢ç­‹ç½‘ç»œã€æ¸—é€å‹è°ƒé¦…ã€å°å£åŠ›å­¦ã€‚",
    count: 9,
    tag: "é¢é£Ÿ",
    links: [
      { label: "é¥ºå­ï¼ˆå†·æ°´é¢æ³•ï¼‰", href: "/recipes/dumplings" },
      { label: "é¥ºå­çš®çš„åŠ›å­¦åŸç†", href: "/kernel/dumpling-wrapper-science" },
      { label: "ä¸ºä»€ä¹ˆé¥ºå­ç…®ç ´äº†ï¼Ÿ", href: "/debug/why-dumplings-break" },
    ],
  },
  {
    name: "æ‰‹æ“€é¢ä¸“é¢˜",
    emoji: "ğŸœ",
    description: "å®½çª„ä¼ çƒ­ã€è‘±æ²¹èƒå–ã€ç‚¸é…±å¹²ç‚¸â€”â€”é¢æ¡ä¸–ç•Œçš„ç‰©ç†å­¦ä¸åŒ–å­¦ã€‚",
    count: 7,
    tag: "é¢é£Ÿ",
    links: [
      { label: "é¢æ¡å®½çª„ä¸å£æ„Ÿç‰©ç†å­¦", href: "/kernel/noodle-shape-science" },
      { label: "è‘±æ²¹æ‹Œé¢", href: "/recipes/scallion-oil-noodles" },
      { label: "ç‚¸é…±é¢", href: "/recipes/zhajiang-noodles" },
    ],
  },
  {
    name: "è‚¥è‚ ä¸“é¢˜",
    emoji: "ğŸ«€",
    description: "å²å“š/ç²ªè‡­ç´ çš„å»é™¤åŒ–å­¦ + çˆ†ç‚’ç¾æ‹‰å¾· + çº¢çƒ§èƒ¶åŸè›‹ç™½æ°´è§£ã€‚",
    count: 4,
    tag: "å†…è„",
    links: [
      { label: "å»è…¥çš„åŒ–å­¦åŸç†", href: "/kernel/offal-cleaning-science" },
      { label: "çˆ†ç‚’è‚¥è‚ ", href: "/recipes/stir-fried-intestines" },
      { label: "çº¢çƒ§å¤§è‚ ", href: "/recipes/braised-pork-intestines" },
    ],
  },
  {
    name: "é±¼ç±»ä¸“é¢˜",
    emoji: "ğŸŸ",
    description: "æ¸…è’¸ã€çº¢çƒ§ã€é…¸èœé±¼â€¦â€¦ä»é±¼ç±»è›‹ç™½ç»“æ„åˆ°å„ç±»çƒ¹é¥ªæ¸©åº¦çª—å£å…¨è§£æã€‚",
    count: 16,
    tag: "é±¼ç±»",
    links: [
      { label: "æ¸…è’¸é²ˆé±¼", href: "/recipes/steamed-sea-bass" },
      { label: "æ°´ç…®é±¼", href: "/recipes/sichuan-boiled-fish" },
      { label: "é±¼æ±¤ä¸ºä»€ä¹ˆæ˜¯å¥¶ç™½è‰²ï¼Ÿ", href: "/kernel/fish-soup-emulsion" },
    ],
  },
  {
    name: "ç‰›è‚‰ä¸“é¢˜",
    emoji: "ğŸ¥©",
    description: "è‚Œçº¤ç»´çƒ­å˜æ€§ + èƒ¶åŸè›‹ç™½æ°´è§£ + ä¸Šæµ†å±éšœâ€”â€”ä»ç‚–åˆ°ç‚’çš„å«©åº¦ç§‘å­¦ã€‚",
    count: 5,
    tag: "ç‰›è‚‰",
    links: [
      { label: "ç‰›è‚‰å«©åº¦çš„ç§‘å­¦", href: "/kernel/beef-tenderness-science" },
      { label: "çº¢çƒ§ç‰›è…©", href: "/recipes/braised-beef-brisket" },
      { label: "é»‘æ¤’ç‰›æŸ³", href: "/recipes/black-pepper-beef" },
    ],
  },
];
---

<BaseLayout title="é¦–é¡µ">
  <!-- Hero Section -->
  <section class="relative overflow-hidden">
    <!-- Background grid effect -->
    <div class="absolute inset-0 bg-[linear-gradient(rgba(20,184,166,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(20,184,166,0.03)_1px,transparent_1px)] bg-[size:64px_64px]"></div>

    <div class="relative mx-auto max-w-6xl px-6 py-24 sm:py-32">
      <div class="max-w-3xl">
        <!-- Terminal-style badge -->
        <div class="mb-6 inline-flex items-center gap-2 rounded-full border border-gray-800 bg-gray-900/80 px-4 py-1.5">
          <span class="h-2 w-2 rounded-full bg-brand-500 animate-pulse"></span>
          <span class="font-mono text-xs text-gray-400">Cooking as Coding</span>
        </div>

        <h1 class="text-4xl font-bold tracking-tight text-gray-50 sm:text-5xl lg:text-6xl">
          ç†ç§‘ç”Ÿ
          <span class="text-brand-400">ä¸‹å¨æˆ¿</span>
        </h1>

        <p class="mt-6 text-xl text-gray-400 leading-relaxed">
          æ‹’ç»ç„å­¦ï¼Œçƒ¹é¥ªæ˜¯ä¸€é—¨ç²¾ç¡®çš„ç§‘å­¦ã€‚<br />
          ç”¨ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©å­¦åŸç†ï¼Œ<span class="text-gray-200">è§£æ„</span>ã€<span class="text-gray-200">é‡åŒ–</span>ã€<span class="text-gray-200">é‡æ„</span>æ¯ä¸€é“èœã€‚
        </p>

        <!-- CTA -->
        <div class="mt-10 flex flex-wrap gap-4">
          <a
            href="/tags/"
            class="inline-flex items-center gap-2 rounded-lg bg-brand-600 px-6 py-3 text-sm font-semibold text-white hover:bg-brand-500 transition-colors"
          >
            é£Ÿæç­›é€‰
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
          <a
            href="/methods/"
            class="inline-flex items-center gap-2 rounded-lg border border-gray-700 px-6 py-3 text-sm font-semibold text-gray-300 hover:border-gray-600 hover:text-gray-100 transition-colors"
          >
            çƒ¹é¥ªæ–¹æ³•
          </a>
          <a
            href="/recipes/"
            class="inline-flex items-center gap-2 rounded-lg border border-gray-700 px-6 py-3 text-sm font-semibold text-gray-300 hover:border-gray-600 hover:text-gray-100 transition-colors"
          >
            æµè§ˆèœè°±åº“
          </a>
          <a
            href="/kernel/"
            class="inline-flex items-center gap-2 rounded-lg border border-gray-700 px-6 py-3 text-sm font-semibold text-gray-300 hover:border-gray-600 hover:text-gray-100 transition-colors"
          >
            æ¢ç´¢åŸç†å±‚
          </a>
        </div>
      </div>

      <!-- Code snippet decoration -->
      <div class="mt-16 rounded-xl border border-gray-800 bg-gray-900/50 p-6 font-mono text-sm">
        <div class="flex items-center gap-2 mb-4">
          <span class="h-3 w-3 rounded-full bg-red-500/60"></span>
          <span class="h-3 w-3 rounded-full bg-yellow-500/60"></span>
          <span class="h-3 w-3 rounded-full bg-green-500/60"></span>
          <span class="ml-3 text-xs text-gray-600">recipe.cook</span>
        </div>
        <pre class="text-gray-400"><code set:html={heroCode} /></pre>
      </div>
    </div>
  </section>

  <!-- Principles Section -->
  <section class="mx-auto max-w-6xl px-6 py-20">
    <div class="mb-10">
      <h2 class="text-2xl font-bold text-gray-100">
        <span class="font-mono text-brand-500">#</span> åº•å±‚åŸç†ç²¾é€‰
      </h2>
      <p class="mt-2 text-gray-500">ç”¨ç§‘å­¦è§£é‡Šä¼ ç»Ÿç»éªŒï¼Œæ¯ä¸€ä¸ª "ä¸ºä»€ä¹ˆ" éƒ½æœ‰ç­”æ¡ˆã€‚</p>
    </div>

    <div class="grid gap-4 sm:grid-cols-2">
      {principles.map((p) => (
        <Card
          title={p.title}
          description={p.description}
          href={p.href}
          field={p.field}
          tag={p.tag}
        />
      ))}
    </div>
  </section>

  <!-- Recent Updates Section -->
  <section class="border-t border-gray-800">
    <div class="mx-auto max-w-6xl px-6 py-20">
      <div class="flex items-end justify-between mb-10">
        <div>
          <h2 class="text-2xl font-bold text-gray-100">
            <span class="font-mono text-brand-500">#</span> æœ€è¿‘æ›´æ–°
          </h2>
          <p class="mt-2 text-gray-500">æœ€æ–°å‘å¸ƒçš„åŸç†æ–‡ç« ã€èœè°±å’Œè°ƒè¯•æŒ‡å—ã€‚</p>
        </div>
        <a
          href="/recipes/"
          class="hidden sm:inline-flex items-center gap-1 font-mono text-xs text-gray-600 hover:text-brand-400 transition-colors"
        >
          æŸ¥çœ‹å…¨éƒ¨
          <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>

      <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
        {recentItems.map((item) => (
          <a
            href={item.href}
            class="group flex flex-col gap-2 rounded-xl border border-gray-800 bg-gray-900/30 p-4 transition-all hover:border-brand-500/40 hover:bg-gray-900/60"
          >
            <div class="flex items-center justify-between">
              <span
                class:list={[
                  "inline-block rounded border px-2 py-0.5 font-mono text-xs",
                  typeStyle[item.type],
                ]}
              >
                {item.type}
              </span>
              <span class="font-mono text-xs text-gray-600">{fmtDate(item.date)}</span>
            </div>
            <h3 class="text-sm font-semibold text-gray-200 group-hover:text-brand-400 transition-colors leading-snug">
              {item.title}
            </h3>
            <p class="text-xs text-gray-500 line-clamp-2 leading-relaxed">{item.description}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Topics Section -->
  <section class="border-t border-gray-800">
    <div class="mx-auto max-w-6xl px-6 py-20">
      <div class="mb-10">
        <h2 class="text-2xl font-bold text-gray-100">
          <span class="font-mono text-brand-500">#</span> ç²¾é€‰ä¸»é¢˜
        </h2>
        <p class="mt-2 text-gray-500">ä»¥é£Ÿææˆ–æŠ€æ³•ä¸ºæ ¸å¿ƒï¼Œè·¨èœè°±ã€åŸç†ã€è°ƒè¯•çš„å®Œæ•´çŸ¥è¯†ç¾¤ã€‚</p>
      </div>

      <div class="grid gap-5 sm:grid-cols-2">
        {featuredTopics.map((topic) => (
          <div class="group rounded-xl border border-gray-800 bg-gray-900/30 p-6 transition-all hover:border-brand-500/30 hover:bg-gray-900/50">
            <div class="flex items-start justify-between mb-3">
              <h3 class="text-lg font-bold text-gray-100 group-hover:text-brand-400 transition-colors">
                {topic.emoji}&nbsp;{topic.name}
              </h3>
              <span class="ml-3 shrink-0 rounded bg-gray-800 px-2 py-0.5 font-mono text-xs text-gray-500">
                {topic.tag}
              </span>
            </div>

            <p class="text-sm text-gray-400 leading-relaxed mb-5">{topic.description}</p>

            <ul class="space-y-1.5 mb-5">
              {topic.links.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="group/link inline-flex items-center gap-1.5 text-sm text-gray-400 hover:text-brand-400 transition-colors"
                  >
                    <svg class="h-3 w-3 shrink-0 text-brand-600 group-hover/link:text-brand-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                    {link.label}
                  </a>
                </li>
              ))}
            </ul>

            <div class="border-t border-gray-800 pt-4">
              <span class="font-mono text-xs text-gray-600">
                {topic.count} ç¯‡ç›¸å…³å†…å®¹
              </span>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Modules Section -->
  <section class="border-t border-gray-800">
    <div class="mx-auto max-w-6xl px-6 py-20">
      <div class="mb-10">
        <h2 class="text-2xl font-bold text-gray-100">
          <span class="font-mono text-brand-500">#</span> ç³»ç»Ÿæ¶æ„
        </h2>
        <p class="mt-2 text-gray-500">åƒæ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œåˆ†å±‚ç»„ç»‡çƒ¹é¥ªçŸ¥è¯†ã€‚</p>
      </div>

      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {modules.map((m) => (
          <a
            href={m.href}
            class="group rounded-xl border border-gray-800 bg-gray-900/30 p-5 transition-all hover:border-brand-500/40 hover:bg-gray-900/60"
          >
            <div class="font-mono text-xs text-gray-600 mb-2">{m.id}</div>
            <h3 class="text-lg font-semibold text-gray-200 group-hover:text-brand-400 transition-colors">
              {m.name}
            </h3>
            <div class="font-mono text-xs text-gray-600 mb-3">{m.eng}</div>
            <p class="text-sm text-gray-500">{m.desc}</p>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Slogan -->
  <section class="border-t border-gray-800 bg-gray-900/30">
    <div class="mx-auto max-w-6xl px-6 py-16 text-center">
      <p class="font-mono text-sm text-gray-600 mb-2">// manifesto</p>
      <blockquote class="text-2xl font-bold text-gray-300 sm:text-3xl">
        "æ‹’ç»ç„å­¦ï¼Œçƒ¹é¥ªæ˜¯ä¸€é—¨<span class="text-brand-400">ç²¾ç¡®çš„ç§‘å­¦</span>ã€‚"
      </blockquote>
    </div>
  </section>
</BaseLayout>
