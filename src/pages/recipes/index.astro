---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const recipes = await getCollection("recipes");
recipes.sort((a, b) => b.data.date.localeCompare(a.data.date));

const difficultyLabel = (d: number) => ["", "简单", "中等", "进阶"][d];
---

<BaseLayout title="菜谱库 / Algorithms" description="精确到克、秒、°C 的标准作业程序">
  <div class="mx-auto max-w-6xl px-6 py-12">
    <!-- Header -->
    <div class="mb-10">
      <div class="font-mono text-xs text-gray-600 mb-2">MOD_03</div>
      <h1 class="text-3xl font-bold text-gray-50 sm:text-4xl">
        菜谱库 <span class="text-brand-400">Algorithms</span>
      </h1>
      <p class="mt-3 text-lg text-gray-400">
        精确到克、秒、°C 的标准作业程序 (SOP)。每一步都有科学注释。
      </p>
    </div>

    <!-- Recipe Cards -->
    <div class="grid gap-4 sm:grid-cols-2">
      {recipes.map((recipe) => (
        <a
          href={`/recipes/${recipe.id.replace(/\.mdx?$/, "")}`}
          class="group block rounded-xl border border-gray-800 bg-gray-900/50 p-6 transition-all hover:border-brand-500/50 hover:bg-gray-900"
        >
          <div class="flex items-center gap-2 mb-3">
            <span class="inline-block rounded-full bg-brand-500/15 border border-brand-500/30 px-2.5 py-0.5 text-xs font-mono text-brand-400">
              {recipe.data.category}
            </span>
            <span class="text-xs text-gray-600 font-mono">
              Lv.{recipe.data.difficulty} {difficultyLabel(recipe.data.difficulty)}
            </span>
          </div>
          <h3 class="text-lg font-semibold text-gray-100 group-hover:text-brand-400 transition-colors">
            {recipe.data.title}
          </h3>
          <p class="mt-2 text-sm text-gray-400 line-clamp-2">
            {recipe.data.description}
          </p>
          <!-- Quick stats -->
          <div class="mt-4 flex items-center gap-4 text-xs font-mono text-gray-600">
            <span>{recipe.data.servings}人份</span>
            <span>{Math.round(recipe.data.totalTimeSec / 60)}min</span>
            <span>peak {recipe.data.peakTempCelsius}°C</span>
          </div>
          <!-- Science tags -->
          <div class="mt-3 flex flex-wrap gap-1.5">
            {recipe.data.scienceTags.map((tag: string) => (
              <span class="rounded bg-gray-800 px-2 py-0.5 text-xs text-gray-500">
                {tag}
              </span>
            ))}
          </div>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
